{"filter":false,"title":"htmlTrait.php","tooltip":"/app/traits/htmlTrait.php","undoManager":{"mark":67,"position":67,"stack":[[{"start":{"row":4,"column":12},"end":{"row":4,"column":13},"action":"insert","lines":["s"],"id":97,"ignore":true}],[{"start":{"row":4,"column":13},"end":{"row":4,"column":15},"action":"insert","lines":["ta"],"id":98,"ignore":true}],[{"start":{"row":4,"column":15},"end":{"row":4,"column":19},"action":"insert","lines":["tic "],"id":99,"ignore":true}],[{"start":{"row":2,"column":0},"end":{"row":2,"column":35},"action":"insert","lines":["use Illuminate\\Support\\Facades\\Log;"],"id":100,"ignore":true},{"start":{"row":4,"column":19},"end":{"row":4,"column":54},"action":"insert","lines":["use Illuminate\\Support\\Facades\\Log;"]}],[{"start":{"row":2,"column":0},"end":{"row":2,"column":35},"action":"remove","lines":["use Illuminate\\Support\\Facades\\Log;"],"id":101,"ignore":true},{"start":{"row":4,"column":19},"end":{"row":4,"column":54},"action":"remove","lines":["use Illuminate\\Support\\Facades\\Log;"]}],[{"start":{"row":2,"column":0},"end":{"row":2,"column":35},"action":"insert","lines":["use Illuminate\\Support\\Facades\\Log;"],"id":102,"ignore":true}],[{"start":{"row":6,"column":5},"end":{"row":181,"column":5},"action":"insert","lines":["","    ","     /*Funcion Principal llamada por el Daemon*/","    public  function start(){  ","       //NOTICIAS SECUESTROS EL UNIVERSAL","      $link='http://www.eluniversal.com/localizador/secuestros';","        $web='http://www.eluniversal.com/noticias/sucesos/';","        $getDate=1;","        $this->AnalizarHTML($link,$web,$getDate);","      /* //NOTICIAS ASESINATOS EL UNIVERSAL","      $link='http://www.eluniversal.com/localizador/asesinatos';","        $web='http://www.eluniversal.com/noticias/sucesos/';","        $this->AnalizarHTML($link,$web,$getDate);","        ","        //NOTICIAS HOMICIDIOS EL UNIVERSAL","        $link='http://www.eluniversal.com/localizador/homicidio';","        $web='http://www.eluniversal.com/noticias/sucesos/';","        $this->AnalizarHTML($link,$web,$getDate);","        ","        //NOTICIAS ROBOS EL UNIVERSAL","        $link='http://www.eluniversal.com/localizador/robos';","        $web='http://www.eluniversal.com/noticias/sucesos/';","        $this->AnalizarHTML($link,$web,$getDate);","        ","        //NOTICIAS SUCESOS EL NACIONAL","        $link='http://www.el-nacional.com/sucesos/';","        $web='http://www.el-nacional.com/noticias/sucesos/';","        $getDate=2;","        $this->AnalizarHTML($link,$web,$getDate);","        ","        //NOTICIAS SUCESOS ULTIMAS NOTICIAS","       $link='http://www.ultimasnoticias.com.ve/seccion/sucesos/';","        $web='http://www.eluniversal.com/noticias/sucesos/';","        $getDate=3;","        $this->AnalizarHTML($link,$web,$getDate);    ","        //NOTICIAS sucesos el noticiero de televen","        $link='http://www.televen.com/el-noticiero/nacionales/sucesos/';","        $web='http://www.televen.com/elnoticiero/';","        $getDate=4;","        $this->AnalizarHTML($link,$web,$getDate);","        */","        ","         //NOTICIAS sucesos Cronica uno","    /*    $link='http://cronica.uno/category/sucesos/';","        $web='http://cronica.uno/category/sucesos/';","        $getDate=5;","        $this->AnalizarHTML($link,$web,$getDate);*/","        ","        //NOTICIAS NACIONALES DEL NOTICIERO VENEVISION HAY QUE HACER VECTOR DE SUCESOS PARA FILTRAR","        //http://www.noticierovenevision.net/noticias/nacional/","        //LLAMAR A LA FUNCION QUE FILTRA EL TIPO DE SUCESO","        ","        //$link='http://www.noticierovenevision.net/noticias/nacional/';","        ","        //$web='http://www.televen.com/elnoticiero/';","        //$getDate=5;","        //$this->AnalizarHTML($link,$web,$getDate);","        ","        //NOTICIAS SUCESOS DEL NOTICIERO GLOBOVISION","       /* $link='http://www.globovision.com/sucesos';","        $web='article';","        $getDate=6;","        $this->AnalizarHTML($link,$web,$getDate);","        $this->twitter('@DiariodeCaracas');","        $this->twitter('@ElNacionalWeb');","        $this->twitter('@Diario_ElTiempo');","        $this->twitter('@webnotitarde');","        $this->twitter('@eldiariolavoz');","        $this->twitter('@diariopanorama');","        $this->twitter('@laverdadweb');*/","    }","    //PROCESAMIENTO DE HTML","    public function AnalizarHTML($url,$web,$getDate){","        //$stemmer = new Spanish(); para ","        ","        $html = new \\Htmldom($url);","       ","        // muestra todo los parrafos ","        ///foreach($html->find('article') as $element) ","        //extrayendo los links de sucesos ","      ","        foreach($html->find('a') as $element) {","        //compara si el substring existe en el link        ","            //$findme   = 'http://www.ultimasnoticias.com.ve/seccion/sucesos/';","            ","            $pos = strpos($element-> href, $web);","            ","            if($pos!==false){","                ","                //busca la ubicacion del suceso","                echo 'LINKs --> '.$element->href.'<br>';","                //se guarda el link y el doc en la BD","              ","                $html2 = new \\Htmldom($element->href);","                //extrayendo la fecha y titulo de la noticia del eluniversal","                if($getDate==1){","                   ","                    $this->getNotice(\"p[class=clearfix]\",'h2[class=title]', $html2,'div[class=note-text] p',$element->href);","                }else{","                //extrayendo la fecha y titulo de la noticia del nacional","                    if($getDate==2){","                           $this->getNotice(\"time[class=date]\",'header[class=detail-header] h1', $html2,'div[class=detail-body] p',$element->href);","                    }else{","                        //extrayendo la fecha y titulo de la noticia del ultimasnoticias","                        if($getDate==3){","                              $this->getNotice(\"span[class=entry-meta] span\",'h1[class=entry-title h1]', $html2,'div[class=entry-content herald-entry-content] p',$element->href);","                        }else{","                            //extrayendo la fecha y titulo de la noticia del noticiero de televen","                            if($getDate==4){","                                $this->getNotice(\"div[class=col-xs-12 col-sm-12 col-md-12 col-lg-12 fechaHora]\" ,\"div[class=col-xs-12 col-sm-12 col-md-12 col-lg-12 titulo] <h1>\", $html2,'div[class=col-xs-12 col-sm-12 col-md-12 col-lg-12 contenido] p',$element->href);","                            }else{","                               if($getDate==5){","                                  ","                                $this->getNotice(\"time[class=xt-post-date]\" ,\"div[class=featured-image-behind-title-wrap gradient-wrap]\", $html2,'div[class=post-body  xt-post-content]  p',$element->href);                               ","                               }else{","                                   if($getDate==6){","                                        $html2 = new \\Htmldom('http://globovision.com'.$element->href);","                                        //globovvision","                                        $this->getNotice(\"time[class=date]\" ,\"h1[class=article-title]\", $html2,'div[class=article-body] div p',$element->href);","                                     }else{","                                   if($getDate==7){","                                        $this->getNotice(\"time[class=date]\" ,\"h1[class=article-title]\", $html2,'div[class=article-body] div p',$element->href);","                                    }","                                     }","                                }","                            }","                        }","                    }","                }","                 ","            }","        } ","    }","        /*Funcion para leer la noticia y extraer sus datos*/","    public function getNotice($Str_fecha, $Str_tittle, $html2, $Str_parrafo,$link){","        //Vector de ubicaciones ","        //vector con las posibles ubicacions de los sucesos","        $ubicacion= $this->ubicaciones();","        $fecha_notic = $html2->find($Str_fecha,0)->plaintext;","        ","      ","        $tittle_notice=$html2->find($Str_tittle,0)->plaintext;","        $articulo='';","        $i=0;","        $encuentraUbic=false;","        while ($i<sizeof($ubicacion) && $encuentraUbic==false){","            //extrayendo el parrafo del link de la noticia","            //verificando que cumpla con la ubicacion","            if(strpos(strtolower ($tittle_notice), $ubicacion[$i]) !== false){","                echo 'LINK REVISANDO --> '.$link.'<br>';","                $encuentraUbic=true;","                 foreach($html2->find($Str_parrafo) as $element2){","                    //concatenando los parrafos del html","                    $articulo=$articulo.$element2;","                }","                //eliminando las etiquetas del parrafo","                $articulo_normalizado=strip_tags(html_entity_decode($articulo, ENT_HTML5, 'UTF-8'));","                $articulo_normalizado=($this->limpiar_caracteres_esp($articulo_normalizado));","                //plain texto sin caracterers especiales","                 echo $fecha_notic.'---'.$tittle_notice.'---<br>'.$articulo_normalizado.'<br>';","                //verificando que no exista ese titulo en la BD para no guardarlo en la BD","                $consultaTitulo=DB::table('documento')->where('titulo',$tittle_notice)->get();","                //Guardando en la BD","                if(sizeof($consultaTitulo)<1){","                    DB::table('documento')->insert(","                    ['titulo' => $tittle_notice, ","                    'link' => $link,","                    'ubicacion'=>$ubicacion[$i],","                    'fecha'=> $fecha_notic,","                    'contenido'=> $articulo_normalizado","                    ]);","                }","            }","        $i++;   ","        }","    }"],"id":103,"ignore":true}],[{"start":{"row":181,"column":5},"end":{"row":196,"column":5},"action":"insert","lines":["","    public function ubicaciones(){","         $ubicacion= array (\"altagracia\",\"antímano\",\"caricuao\",\"catedral\",\"Coche\",\"junquito\",","          \"paraiso\",\"recreo\",\"valle\",\"candelaria\",\"pastora\",\"vega\",\"macarao\",\"catia\",","          \"sanagustín\",\"sanbernardino\",\"sanjose\",\"sanjuan\",\"sanpedro\", 'carlota',","          \"santarosalia\",\"santateresa\",\"23 de enero\",'macarao','caracas',","          'Aragüita', 'Arévalo González','Capaya','Caucagua','Panaquire','Ribas','El Café','Marizapa','Cumbo','San José de Barlovento','El Cafetal','Las Minas',"," 'Nuestra Señora del Rosario', 'Higuerote', 'Curiepe', 'Tacarigua de Brión', 'Mamporal', 'Carrizal', 'Chacao', 'Charallave', 'Las Brisas',"," 'El Hatillo', 'Altagracia de la Montaña', 'Cecilio Acosta', 'Los Teques', 'El Jarillo', 'San Pedro', 'Tácata', 'Paracotos', 'Cartanal',"," 'Santa Teresa del Tuy', 'La Democracia', 'Ocumare del Tuy', 'Santa Bárbara', 'San Antonio de los Altos', 'Río Chico', 'El Guapo',"," 'Tacarigua de la Laguna', 'Paparo', 'San Fernando del Guapo', 'Santa Lucía del Tuy', 'Cúpira', 'Machurucuto', 'Guarenas',"," 'San Antonio de Yare', 'San Francisco de Yare', 'Leoncio Martínez', 'Petare', 'Caucagüita', 'Filas de Mariche', 'La Dolorita',"," 'Cúa','Nueva Cúa', 'Guatire', 'Bolívar');","","    return $ubicacion;","    }"],"id":104,"ignore":true}],[{"start":{"row":9,"column":10},"end":{"row":9,"column":17},"action":"insert","lines":[" static"],"id":105,"ignore":true}],[{"start":{"row":14,"column":8},"end":{"row":14,"column":15},"action":"remove","lines":["$this->"],"id":106,"ignore":true}],[{"start":{"row":3,"column":17},"end":{"row":5,"column":4},"action":"insert","lines":["","    ","    "],"id":107,"ignore":true}],[{"start":{"row":16,"column":8},"end":{"row":16,"column":17},"action":"insert","lines":["htmlTrait"],"id":108,"ignore":true}],[{"start":{"row":16,"column":8},"end":{"row":16,"column":17},"action":"remove","lines":["htmlTrait"],"id":109,"ignore":true}],[{"start":{"row":16,"column":8},"end":{"row":16,"column":11},"action":"insert","lines":["sel"],"id":110,"ignore":true}],[{"start":{"row":16,"column":11},"end":{"row":16,"column":12},"action":"insert","lines":["f"],"id":111,"ignore":true}],[{"start":{"row":16,"column":12},"end":{"row":16,"column":13},"action":"insert","lines":[":"],"id":112,"ignore":true}],[{"start":{"row":16,"column":13},"end":{"row":16,"column":14},"action":"insert","lines":[":"],"id":113,"ignore":true}],[{"start":{"row":80,"column":11},"end":{"row":80,"column":12},"action":"insert","lines":["s"],"id":114,"ignore":true}],[{"start":{"row":80,"column":12},"end":{"row":80,"column":14},"action":"insert","lines":["ta"],"id":115,"ignore":true}],[{"start":{"row":80,"column":14},"end":{"row":80,"column":15},"action":"insert","lines":["c"],"id":116,"ignore":true}],[{"start":{"row":80,"column":15},"end":{"row":80,"column":16},"action":"insert","lines":["t"],"id":117,"ignore":true}],[{"start":{"row":80,"column":16},"end":{"row":80,"column":19},"action":"insert","lines":["ic "],"id":118,"ignore":true}],[{"start":{"row":80,"column":14},"end":{"row":80,"column":15},"action":"remove","lines":["c"],"id":119,"ignore":true}],[{"start":{"row":83,"column":29},"end":{"row":83,"column":33},"action":"remove","lines":["$url"],"id":120,"ignore":true},{"start":{"row":83,"column":29},"end":{"row":83,"column":79},"action":"insert","lines":["http://www.eluniversal.com/localizador/secuestros'"]}],[{"start":{"row":83,"column":29},"end":{"row":83,"column":30},"action":"insert","lines":["'"],"id":121,"ignore":true}],[{"start":{"row":83,"column":80},"end":{"row":83,"column":81},"action":"insert","lines":["'"],"id":122,"ignore":true}],[{"start":{"row":83,"column":80},"end":{"row":83,"column":81},"action":"remove","lines":["'"],"id":123,"ignore":true}],[{"start":{"row":83,"column":29},"end":{"row":83,"column":80},"action":"remove","lines":["'http://www.eluniversal.com/localizador/secuestros'"],"id":124,"ignore":true}],[{"start":{"row":80,"column":44},"end":{"row":80,"column":96},"action":"insert","lines":["='http://www.eluniversal.com/localizador/secuestros'"],"id":125,"ignore":true}],[{"start":{"row":83,"column":29},"end":{"row":83,"column":33},"action":"insert","lines":["$url"],"id":126,"ignore":true}],[{"start":{"row":2,"column":35},"end":{"row":3,"column":0},"action":"insert","lines":["",""],"id":127,"ignore":true}],[{"start":{"row":3,"column":0},"end":{"row":3,"column":3},"action":"insert","lines":["use"],"id":128,"ignore":true}],[{"start":{"row":3,"column":3},"end":{"row":3,"column":4},"action":"insert","lines":[" "],"id":129,"ignore":true}],[{"start":{"row":3,"column":4},"end":{"row":3,"column":11},"action":"insert","lines":["Htmldom"],"id":130,"ignore":true}],[{"start":{"row":3,"column":11},"end":{"row":3,"column":12},"action":"insert","lines":[";"],"id":131,"ignore":true}],[{"start":{"row":85,"column":7},"end":{"row":85,"column":52},"action":"insert","lines":["Log::info(\"Demonio ejecuantose desde trait\");"],"id":132,"ignore":true}],[{"start":{"row":85,"column":17},"end":{"row":85,"column":50},"action":"remove","lines":["\"Demonio ejecuantose desde trait\""],"id":133,"ignore":true},{"start":{"row":85,"column":17},"end":{"row":85,"column":22},"action":"insert","lines":["$html"]}],[{"start":{"row":10,"column":4},"end":{"row":10,"column":16},"action":"insert","lines":["$this->html="],"id":134,"ignore":true}],[{"start":{"row":10,"column":15},"end":{"row":10,"column":16},"action":"remove","lines":["="],"id":135,"ignore":true}],[{"start":{"row":10,"column":15},"end":{"row":10,"column":16},"action":"insert","lines":["="],"id":136,"ignore":true}],[{"start":{"row":5,"column":4},"end":{"row":9,"column":5},"action":"insert","lines":["public function __construct()","    {","        ","        parent::__construct();","    }"],"id":137,"ignore":true}],[{"start":{"row":14,"column":4},"end":{"row":14,"column":16},"action":"remove","lines":["$this->html="],"id":138,"ignore":true}],[{"start":{"row":8,"column":8},"end":{"row":8,"column":30},"action":"remove","lines":["parent::__construct();"],"id":139,"ignore":true},{"start":{"row":8,"column":8},"end":{"row":8,"column":20},"action":"insert","lines":["$this->html="]}],[{"start":{"row":4,"column":17},"end":{"row":5,"column":4},"action":"insert","lines":["","    "],"id":140,"ignore":true}],[{"start":{"row":5,"column":4},"end":{"row":5,"column":5},"action":"insert","lines":["p"],"id":141,"ignore":true}],[{"start":{"row":5,"column":5},"end":{"row":5,"column":7},"action":"insert","lines":["ro"],"id":142,"ignore":true}],[{"start":{"row":5,"column":7},"end":{"row":5,"column":10},"action":"insert","lines":["cte"],"id":143,"ignore":true}],[{"start":{"row":5,"column":8},"end":{"row":5,"column":10},"action":"remove","lines":["te"],"id":144,"ignore":true}],[{"start":{"row":5,"column":7},"end":{"row":5,"column":8},"action":"remove","lines":["c"],"id":145,"ignore":true},{"start":{"row":5,"column":7},"end":{"row":5,"column":10},"action":"insert","lines":["tec"]}],[{"start":{"row":5,"column":4},"end":{"row":5,"column":10},"action":"remove","lines":["protec"],"id":146,"ignore":true},{"start":{"row":5,"column":4},"end":{"row":5,"column":14},"action":"insert","lines":["protected "]}],[{"start":{"row":5,"column":14},"end":{"row":5,"column":15},"action":"insert","lines":["$"],"id":147,"ignore":true}],[{"start":{"row":5,"column":15},"end":{"row":5,"column":17},"action":"insert","lines":["ht"],"id":148,"ignore":true}],[{"start":{"row":5,"column":17},"end":{"row":5,"column":19},"action":"insert","lines":["ml"],"id":149,"ignore":true}],[{"start":{"row":5,"column":19},"end":{"row":5,"column":20},"action":"insert","lines":[";"],"id":150,"ignore":true}],[{"start":{"row":9,"column":20},"end":{"row":9,"column":21},"action":"insert","lines":[" "],"id":151,"ignore":true}],[{"start":{"row":9,"column":21},"end":{"row":9,"column":22},"action":"insert","lines":["n"],"id":152,"ignore":true}],[{"start":{"row":9,"column":22},"end":{"row":9,"column":24},"action":"insert","lines":["ew"],"id":153,"ignore":true}],[{"start":{"row":9,"column":24},"end":{"row":9,"column":25},"action":"insert","lines":[" "],"id":154,"ignore":true}],[{"start":{"row":9,"column":25},"end":{"row":9,"column":32},"action":"insert","lines":["Htmldom"],"id":155,"ignore":true}],[{"start":{"row":9,"column":32},"end":{"row":9,"column":34},"action":"insert","lines":["()"],"id":156,"ignore":true}],[{"start":{"row":9,"column":34},"end":{"row":9,"column":35},"action":"insert","lines":[";"],"id":157,"ignore":true}],[{"start":{"row":13,"column":54},"end":{"row":14,"column":54},"action":"insert","lines":["","         Log::info(\"Demonio ejecuantose desde trait\");"],"id":158,"ignore":true}],[{"start":{"row":14,"column":9},"end":{"row":14,"column":54},"action":"remove","lines":["Log::info(\"Demonio ejecuantose desde trait\");"],"id":159,"ignore":true}],[{"start":{"row":20,"column":6},"end":{"row":20,"column":8},"action":"insert","lines":["/*"],"id":160,"ignore":true},{"start":{"row":23,"column":48},"end":{"row":23,"column":50},"action":"insert","lines":["*/"]}],[{"start":{"row":18,"column":38},"end":{"row":19,"column":8},"action":"insert","lines":["","        "],"id":161,"ignore":true}],[{"start":{"row":19,"column":8},"end":{"row":19,"column":54},"action":"insert","lines":[" Log::info(\"Demonio ejecuantose desde trait\");"],"id":162,"ignore":true}],[{"start":{"row":19,"column":19},"end":{"row":19,"column":52},"action":"remove","lines":["\"Demonio ejecuantose desde trait\""],"id":163,"ignore":true},{"start":{"row":19,"column":19},"end":{"row":19,"column":30},"action":"insert","lines":["$this->html"]}],[{"start":{"row":8,"column":8},"end":{"row":8,"column":30},"action":"insert","lines":["parent::__construct();"],"id":164,"ignore":true}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":13,"column":51},"end":{"row":13,"column":51},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":280,"mode":"ace/mode/php"}},"timestamp":1512913713035,"hash":"2c8aa8330755397d3278b58180bdb960ada849b4"}